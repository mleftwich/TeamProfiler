// USE JQUERY
let jsdom = require("jsdom");
let dom = "...";
let { window } = new jsdom.JSDOM(dom);
const $ = require("jquery")(window);

// CREATE DIV TO HOLD ALL EMPLOYEE CARDS
container = $("<div>");
$(container).attr(
  "class",
  "container col-12 d-flex flex-wrap justify-content-center"
);

// FUNCTION TO GENERATE HTML WITH USER INPUT
function outputHtml(employees) {
  // LOOP THROUGH EACH EMPLOYEE ENTRY AND GET NAME, ID, ROLE, ATTRIBUTE
  employees.forEach((employee) => {
    // DEFINE VARIABLES
    var role = employee.getRole();
    var name = employee.name;
    var id = employee.id;
    var email = employee.email;

    if (role === "Manager") {
      var attr = employee.officeNum;
      var attrId = "OFFICE #: ";
      var iconEl = $("<img>");
      $(iconEl).attr("src", "../assets/imgs/manager.png");
      $(iconEl).attr("class", "float-right top");
      $(iconEl).attr("width", "40rem");
    }
    if (role === "Engineer") {
      var attr = employee.gitHub;
      var attrId = "GITHUB: ";
      var iconEl = $("<img>");
      $(iconEl).attr("src", "../assets/imgs/engineer.png");
      $(iconEl).attr("class", "float-right top");
      $(iconEl).attr("width", "40rem");
      var gitLink = $("<a>");
      $(gitLink).attr("href", `https://www.github.com/${attr}`);
      $(gitLink).attr("target", "_blank");
    }
    if (role === "Intern") {
      var attr = employee.school;
      var attrId = "SCHOOL: ";
      var iconEl = $("<img>");
      $(iconEl).attr("src", "../assets/imgs/intern.png");
      $(iconEl).attr("class", "float-right top");
      $(iconEl).attr("width", "40rem");
    }

    // EMPLOYEE MAIN CARD
    const card = $("<div>");
    $(card).attr("class", "card m-3 w-30 employee-card shadow-sm d-block");
    $(card).attr("id", Math.floor(Math.random() * 100));
    $(container).append(card);

    // CARD HEADER
    const header = $("<div>");
    $(header).append(iconEl);
    $(header).attr("class", "card-header name-role");
    const nameEl = $("<p class='font-weight-bold'>");
    const roleEl = $("<p class='badge badge-info p-1'>");
    $(nameEl).text(name);
    $(header).append(nameEl);
    $(roleEl).text(role);
    $(header).append(roleEl);
    $(card).append(header);

    // CARD BODY
    const body = $("<div>");
    $(body).attr("class", "card-body info");
    const bodyEl = $("<ul>");
    $(bodyEl).attr("class", "list-group list-group-flush");
    $(body).append(bodyEl);

    // EMPLOYEE ID
    const empId = $("<li>");
    $(empId).attr("class", "list-group-item");
    $(empId).text("ID: " + id);
    $(bodyEl).append(empId);

    // EMPLOYEE EMAIL
    const empEmail = $("<li>");
    let mailto = $("<a>");
    $(mailto).attr("href", `mailto:${email}`);
    $(mailto).attr("class", "text-info");
    $(mailto).text(email);
    $(empEmail).attr("class", "list-group-item");
    $(empEmail).text("EMAIL: ");
    $(empEmail).append(mailto);
    $(bodyEl).append(empEmail);

    // EMPLOYEE OFFICENUM/GITHUB/SCHOOL
      // if employer is engineer link github
    const empAttr = $("<li>");
    if (role === "Engineer") {
      $(empAttr).text(attrId);
      $(empAttr).append(gitLink);
      $(gitLink).text(attr);
      $(gitLink).attr("class", "text-info")
      $(empAttr).attr("class", "list-group-item");
      $(bodyEl).append(empAttr);
      $(card).append(body);
      // otherwise
    } else {
      $(empAttr).attr("class", "list-group-item");
      $(empAttr).text(attrId + attr);
      $(bodyEl).append(empAttr);
      $(card).append(body);
    }
  });

  return `

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="Description" content="Team Profile Page - Generated by TeamProfiler"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.6.0/css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
<link rel="stylesheet" href="assets/css/style.css">
<title>Team Profile Page</title>
</head>
<body>

    <!-- HEADER -->
    <div class="jumbotron">
        <div class="container">
            <h1 class="display-3 text-center text-monospace">Team Members</h1>
            <p class="lead text-center text-monospace text-black-50">Breakdown of each team member and their role</p>
            <hr class="my-2">
            <p class="card-text text-center text-info font-weight-lighter text-monospace">Generated with TeamProfiler</p>
            </div>
    </div>
    
    <!-- CARDS -->
    ${container[0].outerHTML}

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.slim.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.1/umd/popper.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.6.0/js/bootstrap.min.js"></script>
</body>
</html>

`;
}

module.exports = outputHtml;
